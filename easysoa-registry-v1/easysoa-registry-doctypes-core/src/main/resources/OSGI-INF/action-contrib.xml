<?xml version="1.0" ?>
<component name="org.easysoa.registry.core.doctypes.action.contrib">

  <require>org.nuxeo.ecm.platform.actions</require>

  <!-- ======= -->
  <!-- Filters  -->
  <!-- ======= -->
  <extension target="org.nuxeo.ecm.platform.actions.ActionService" point="filters">
  
    <!-- Override. Enable common "New" button on workspace roots -->
    <filter id="create">
      <!-- original value : -->
      <!-- rule grant="true">
        <permission>AddChildren</permission>
        <type>Root</type>
        <type>Domain</type>
        <facet>Folderish</facet>
        <type>Workspace</type>
        <type>TemplateRoot</type>
        <type>Section</type>
        <type>Folder</type>
        <type>OrderedFolder</type>
        <type>Project</type><!- suppl ->
        <type>Subproject</type><!- suppl ->
        <condition>
          #{typeManager.getAllowedSubTypes(document.getType(),
          document).size()
          > 0}
        </condition>
      </rule -->
    
      <rule grant="true">
        <permission>AddChildren</permission>
        <type>WorkspaceRoot</type>
        <type>SystemTreeRoot</type>
        <type>Project</type><!-- suppl -->
        <type>Subproject</type><!-- suppl -->
      </rule>
      <rule grant="true">
        <condition>#{document.hasFacet("SoaNode") and document.hasFacet("Folderish")}</condition>
      </rule>
      <rule grant="false">
        <type>Repository</type>
      </rule>
    </filter>
    
  </extension>
  
  <!-- ======= -->
  <!-- Actions  -->
  <!-- ======= -->
  <extension target="org.nuxeo.ecm.platform.actions.ActionService" point="actions">

    <!-- Override. Hide "Create a new workspace" link -->
    <action id="newWorkspace" enabled="false" />
    
    <!-- Redefine content tab to display both listing & properties -->
    <action id="TAB_CONTENT" link="/incl/tabs/easysoa_document_content.xhtml" order="10"
      label="action.view.content" icon="/icons/file.gif">
      <category>VIEW_ACTION_LIST</category>
      <filter-id>isFolderish</filter-id>
    </action>
    
    <!-- Redefine view tab to display parents -->
    <action id="TAB_VIEW" link="/incl/tabs/easysoa_document_view.xhtml" order="0"
      label="action.view.summary" icon="/icons/file.gif">
      <category>VIEW_ACTION_LIST</category>
      <filter-id>view</filter-id>
    </action>
  
    <action id="createSubprojectVersion" link="#{subprojectActions.createSubprojectVersion()}"
      label="command.createSubprojectVersion" icon="/icons/action_add.gif">
      <category>SUBVIEW_UPPER_LIST</category>
      <filter id="createSubprojectVersion">
        <rule grant="true">
          <permission>AddChildren</permission><!-- TODO -->
          <type>Subproject</type>
        </rule>
      </filter>
    </action>
    
  </extension>

</component>
