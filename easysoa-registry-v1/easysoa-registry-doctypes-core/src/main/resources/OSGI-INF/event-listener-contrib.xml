<?xml version="1.0"?>
<component name="org.easysoa.registry.doctypes.core.eventlistener.contrib">

  <require>filemanager.core.listener.icon</require><!-- to override mimetypeIconUpdater listener -->

  <!-- =============== -->
  <!-- Event listeners -->
  <!-- =============== -->

  <!-- Prority set to 150 to run after dcListener, which inits "created" -->

  <extension target="org.nuxeo.ecm.core.event.EventServiceComponent" point="listener">
    <listener name="repositoryManagementListener" class="org.easysoa.registry.RepositoryManagementListener" priority="155">
      <event>documentCreated</event>
      <event>documentCreatedByCopy</event>
      <event>documentMoved</event>
      <event>documentModified</event>
      <event>aboutToRemove</event>
    </listener>
    
    <listener name="soaNodeMatchingListener" class="org.easysoa.registry.SoaNodeMatchingListener"
    	priority="156">
      <event>documentCreated</event>
      <event>documentModified</event>
    </listener>
    
    <!-- TODO : priority ? set to 151 ?? -->
    <!-- Events : keep documentCreated & documentModified ? -->
    <listener name="resourceListener" class="org.easysoa.registry.types.listeners.ResourceListener"
      priority="151">
      <event>documentCreated</event>
      <event>documentModified</event>
    </listener>    
    <!-- TODO : Refactoring ? modify event for wsdlParsingListener ?? -->
    <listener name="wsdlParsingListener" class="org.easysoa.registry.types.listeners.WSDLParsingListener"
      priority="152">
      <!--<event>documentCreated</event>--><!-- TODO rm -->
      <!--<event>documentModified</event>--><!-- TODO rm -->
      <event>resourceDownloaded</event><!-- triggered by ResourceUpdateService -->
    </listener>
    
    <listener name="componentListener" class="org.easysoa.registry.types.listeners.ComponentListener"
      priority="151">
      <event>documentCreated</event>
      <event>beforeDocumentModification</event>
    </listener>
    
    <listener name="subprojectListener" class="org.easysoa.registry.subproject.SubprojectNodeListener"
      priority="150">
      <event>aboutToCreate</event>
      <event>beforeDocumentModification</event><!-- TODO test -->
    </listener>
    
    <!-- OBSOLETE replaced by logic before and after snapshotting, see SubprojectServiceImpl.createSubprojectVersion() -->
    <!-- listener name="treeSnapshotListener" class="org.easysoa.registry.subproject.TreeSnapshotListener"
      priority="151">
      <event>aboutToCreateLeafVersionEvent</event>
    </listener -->
    
    <!-- Overriding so document icons will always stay set to their type icon and never become their mimetype
    icon (otherwise, WSDL etc. mimetypes should be given pretty service + XML / graffle.png icons) -->
    <listener name="mimetypeIconUpdater" async="false" postCommit="false" class="org.easysoa.registry.types.listeners.TypeIconMimetypeIconUpdater" priority="120">
      <event>aboutToCreate</event>
      <event>beforeDocumentModification</event>
    </listener>
    
  </extension>

</component>
